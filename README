ElemRV
======

Fully Open Source RISC-V Microcontroller written in SpinalHDL. The chip layout was done with the IHP SG13G2 PDK and the open RTL-to-GDSII tool OpenROAD.

Installation
############

ElemRV-init comes with a container image which has all required host dependencies installed. Therefore, only the sources have to be locally installed and you keep your host system clean.

- Install podman::

	sudo apt install podman

- Build a container::

	podman build -t elemrv-init:v1 .

- Download all sources::

	chmod +x init.sh
	./init.sh

Container
#########

The following command can be used to run Makefile targets. Just replace <target> with the correct name.

.. code-block:: text

    podman run \
        --rm=true \
        -v /home:/home \
        -v $XAUTHORITY:$XAUTHORITY:ro \
        -v /tmp/.X11-unix:/tmp/.X11-unix:ro \
        --userns=keep-id \
        --workdir=$PWD \
        -e "DISPLAY" \
        -it elemrv-init:v1 \
        bash -c 'make <target>'

Please keep in mind that Klayout needs to write to the PDK directory to proper draw all cells. Just add
an additional volume to the podman run command.

.. code-block:: text

    podman run \
        --rm=true \
        -v $PWD/pdks/:/opt/elements/pdks/ \
        -v /home:/home \
        ...

ASIC Flow
#########

First, create a layout from the Verilog file.

.. code-block:: text

    podman run \
        --rm=true \
        -v /home:/home \
        -v $XAUTHORITY:$XAUTHORITY:ro \
        -v /tmp/.X11-unix:/tmp/.X11-unix:ro \
        --userns=keep-id \
        --workdir=$PWD \
        -e "DISPLAY" \
        -it elemrv-init:v1 \
        bash -c 'make sg13g2-synthesize'

Please check Known Issues in case the chip layout failed.

Next, open the chip layout and inspect the layout.

.. code-block:: text

    podman run \
        --rm=true \
        -v $PWD/pdks/:/opt/elements/pdks/ \
        -v /home:/home \
        -v $XAUTHORITY:$XAUTHORITY:ro \
        -v /tmp/.X11-unix:/tmp/.X11-unix:ro \
        --userns=keep-id \
        --workdir=$PWD \
        -e "DISPLAY" \
        -it elemrv-init:v1 \
        bash -c 'make sg13g2-klayout'

Alternatively, run Design Rule Checks to verify the chip is good.

.. code-block:: text

    podman run \
        --rm=true \
        -v $PWD/pdks/:/opt/elements/pdks/ \
        -v /home:/home \
        -v $XAUTHORITY:$XAUTHORITY:ro \
        -v /tmp/.X11-unix:/tmp/.X11-unix:ro \
        --userns=keep-id \
        --workdir=$PWD \
        -e "DISPLAY" \
        -it elemrv-init:v1 \
        bash -c 'make sg13g2-drc'

Use the `make sg13g2-drc-gui` target to show all DRC issues.

Known Issues
############

No known issues so far.

License
#######

Copyright (c) 2024 Steffen Reith and Daniel Schultz. Released under the `Apache License`_.

.. _Apache License: LICENSE

